generalized_tables:
  # etldoc: osm_border_linestring -> osm_border_disp_linestring
  border_disp_linestring:
    source: border_linestring
    sql_filter: ST_GeometryType(geometry) = 'ST_LineString' AND (disputed OR dispute OR border_status = 'disputed' OR disputed_by <> '') AND admin_level = 2

  # etldoc: osm_admin_boundary_polygon_gen_z5 -> osm_admin_boundary_polygon_gen_z4
  admin_boundary_polygon_gen_z4:
    source: admin_boundary_polygon_gen_z5
    sql_filter: area>power(ZRES3,2)
    tolerance: ZRES4

  # etldoc: osm_admin_boundary_polygon_gen_z6 -> osm_admin_boundary_polygon_gen_z5
  admin_boundary_polygon_gen_z5:
    source: admin_boundary_polygon_gen_z6
    sql_filter: area>power(ZRES4,2)
    tolerance: ZRES5

  # etldoc: osm_admin_boundary_polygon_gen_z7 -> osm_admin_boundary_polygon_gen_z6
  admin_boundary_polygon_gen_z6:
    source: admin_boundary_polygon_gen_z7
    sql_filter: area>power(ZRES5,2)
    tolerance: ZRES6

  # etldoc: osm_admin_boundary_polygon_gen_z8 -> osm_admin_boundary_polygon_gen_z7
  admin_boundary_polygon_gen_z7:
    source: admin_boundary_polygon_gen_z8
    sql_filter: area>power(ZRES6,2)
    tolerance: ZRES7

  # etldoc: osm_admin_boundary_polygon_gen_z9 -> osm_admin_boundary_polygon_gen_z8
  admin_boundary_polygon_gen_z8:
    source: admin_boundary_polygon_gen_z9
    sql_filter: area>power(ZRES7,2)
    tolerance: ZRES8

  # etldoc: osm_admin_boundary_polygon_gen_z10 -> osm_admin_boundary_polygon_gen_z9
  admin_boundary_polygon_gen_z9:
    source: admin_boundary_polygon_gen_z10
    sql_filter: area>power(ZRES8,2)
    tolerance: ZRES9

  # etldoc: osm_admin_boundary_polygon_gen_z11 -> osm_admin_boundary_polygon_gen_z10
  admin_boundary_polygon_gen_z10:
    source: admin_boundary_polygon_gen_z11
    sql_filter: area>power(ZRES9,2)
    tolerance: ZRES10

  # etldoc: osm_admin_boundary_polygon_gen_z12 -> osm_admin_boundary_polygon_gen_z11
  admin_boundary_polygon_gen_z11:
    source: admin_boundary_polygon_gen_z12
    sql_filter: area>power(ZRES10,2)
    tolerance: ZRES11

  # etldoc: osm_admin_boundary_polygon_gen_z13 -> osm_admin_boundary_polygon_gen_z12
  admin_boundary_polygon_gen_z12:
    source: admin_boundary_polygon_gen_z13
    sql_filter: area>power(ZRES11,2)
    tolerance: ZRES12

  # etldoc: osm_admin_boundary_polygon -> osm_admin_boundary_polygon_gen_z13
  admin_boundary_polygon_gen_z13:
    source: admin_boundary_polygon
    sql_filter: area>power(ZRES12,2) AND ST_IsValid(geometry)
    tolerance: ZRES13

  # etldoc: osm_aboriginal_boundary_polygon_gen_z5 -> osm_aboriginal_boundary_polygon_gen_z4
  aboriginal_boundary_polygon_gen_z4:
    source: aboriginal_boundary_polygon_gen_z5
    sql_filter: area>power(ZRES3,2)
    tolerance: ZRES4

  # etldoc: osm_aboriginal_boundary_polygon_gen_z6 -> osm_aboriginal_boundary_polygon_gen_z5
  aboriginal_boundary_polygon_gen_z5:
    source: aboriginal_boundary_polygon_gen_z6
    sql_filter: area>power(ZRES4,2)
    tolerance: ZRES5

  # etldoc: osm_aboriginal_boundary_polygon_gen_z7 -> osm_aboriginal_boundary_polygon_gen_z6
  aboriginal_boundary_polygon_gen_z6:
    source: aboriginal_boundary_polygon_gen_z7
    sql_filter: area>power(ZRES5,2)
    tolerance: ZRES6

  # etldoc: osm_aboriginal_boundary_polygon_gen_z8 -> osm_aboriginal_boundary_polygon_gen_z7
  aboriginal_boundary_polygon_gen_z7:
    source: aboriginal_boundary_polygon_gen_z8
    sql_filter: area>power(ZRES6,2)
    tolerance: ZRES7

  # etldoc: osm_aboriginal_boundary_polygon_gen_z9 -> osm_aboriginal_boundary_polygon_gen_z8
  aboriginal_boundary_polygon_gen_z8:
    source: aboriginal_boundary_polygon_gen_z9
    sql_filter: area>power(ZRES7,2)
    tolerance: ZRES8

  # etldoc: osm_aboriginal_boundary_polygon_gen_z10 -> osm_aboriginal_boundary_polygon_gen_z9
  aboriginal_boundary_polygon_gen_z9:
    source: aboriginal_boundary_polygon_gen_z10
    sql_filter: area>power(ZRES8,2)
    tolerance: ZRES9

  # etldoc: osm_aboriginal_boundary_polygon_gen_z11 -> osm_aboriginal_boundary_polygon_gen_z10
  aboriginal_boundary_polygon_gen_z10:
    source: aboriginal_boundary_polygon_gen_z11
    sql_filter: area>power(ZRES9,2)
    tolerance: ZRES10

  # etldoc: osm_aboriginal_boundary_polygon_gen_z12 -> osm_aboriginal_boundary_polygon_gen_z11
  aboriginal_boundary_polygon_gen_z11:
    source: aboriginal_boundary_polygon_gen_z12
    sql_filter: area>power(ZRES10,2)
    tolerance: ZRES11

  # etldoc: osm_aboriginal_boundary_polygon_gen_z13 -> osm_aboriginal_boundary_polygon_gen_z12
  aboriginal_boundary_polygon_gen_z12:
    source: aboriginal_boundary_polygon_gen_z13
    sql_filter: area>power(ZRES11,2)
    tolerance: ZRES12

  # etldoc: osm_aboriginal_boundary_polygon -> osm_aboriginal_boundary_polygon_gen_z13
  aboriginal_boundary_polygon_gen_z13:
    source: aboriginal_boundary_polygon
    sql_filter: area>power(ZRES12,2) AND ST_IsValid(geometry)
    tolerance: ZRES13


tables:
  # etldoc: imposm3 -> osm_border_linestring
  border_linestring:
    type: relation_member
    filters:
      require:
        admin_level: [__any__]
        boundary: [administrative]
    columns:
    - name: relation_id
      type: id
    - name: osm_id
      type: id
      from_member: true
    - name: member
      type: member_id
    - name: type
      type: member_type
    - name: geometry
      type: geometry
    - key: name
      name: name
      type: string
      # Used for disputed boundary, e.g. "Line of actual control"
      from_member: true
    - key: admin_level
      name: admin_level
      type: integer
    - key: claimed_by
      name: claimed_by
      type: string
    - key: disputed_by
      name: disputed_by
      type: string
      from_member: true
    - key: dispute 
      name: dispute 
      type: bool
      from_member: true
    - key: disputed
      name: disputed
      type: bool
      from_member: true
    - key: border_status
      name: border_status
      type: string
      from_member: true
    - key: maritime
      name: maritime
      type: bool
      from_member: true
    - key: boundary_type
      name: boundary_type
      type: string
      from_member: true
    - key: natural
      name: natural
      type: string
      from_member: true
    relation_types: [boundary]
    mapping:
      boundary:
      - administrative
      border_status:
      - dispute
      boundary_type:
      - maritime

  # etldoc: imposm3 -> osm_aboriginal_boundary_polygon
  aboriginal_boundary_polygon:
    type: polygon
    filters:
      require:
        type: [boundary]
        boundary: [aboriginal_lands]
    columns:
    - name: osm_id
      type: id
    - name: geometry
      type: validated_geometry
    - name: name
      key: name
      type: string
    - name: tags
      type: hstore_tags
    - name: boundary
      key: boundary
      type: string
    - name: area
      type: area
    mapping:
      boundary:
      - aboriginal_lands

  # etldoc: imposm3 -> osm_admin_boundary_polygon
  admin_boundary_polygon:
    type: polygon
    filters:
      require:
        type: [boundary]
        admin_level: [__any__]
        boundary: [administrative]
    columns:
    - name: osm_id
      type: id
    - name: geometry
      type: validated_geometry
    - name: name
      key: name
      type: string
    - name: tags
      type: hstore_tags
    - name: admin_level
      key: admin_level
      type: integer
    - name: boundary
      key: boundary
      type: string
    - name: area
      type: area
    mapping:
      boundary:
      - administrative
